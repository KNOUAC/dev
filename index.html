<div id="quiz-list" class="space-y-20"></div>
<div class="h-40"></div>
</div>

<script>
    // 1. 전역 변수 선언 (데이터를 담을 빈 배열)
    let questions = [];

    // 2. 페이지 로드 시 JSON 데이터 불러오기
    document.addEventListener("DOMContentLoaded", () => {
        fetch('./questions.json') // 같은 폴더의 json 파일 요청
            .then(response => {
                if (!response.ok) {
                    throw new Error("JSON 파일을 찾을 수 없거나 불러오는데 실패했습니다.");
                }
                return response.json();
            })
            .then(data => {
                questions = data; // 가져온 데이터를 변수에 저장
                renderAllQuestions(); // 화면 렌더링 시작
            })
            .catch(error => {
                console.error('Error:', error);
                document.getElementById('quiz-list').innerHTML = 
                    `<div class="p-4 text-center text-red-600 font-bold bg-red-50 rounded">
                        데이터를 불러오지 못했습니다.<br>
                        (CORS 정책 문제일 수 있습니다. Live Server를 사용해주세요.)
                    </div>`;
            });
    });

    // 3. 기존 렌더링 함수 (변수명 변경 없음)
    function renderAllQuestions() {
        const container = document.getElementById('quiz-list');
        container.innerHTML = '';

        if (questions.length === 0) return; // 데이터가 없으면 중단

        questions.forEach((q, index) => {
            // ... (기존 renderAllQuestions 내부 로직 100% 동일) ...
            // 기존 코드 그대로 복사해서 사용하시면 됩니다.
            const qNum = q.id ? q.id : index + 1;
            const wrapper = document.createElement('div');
            wrapper.className = "question-block";
            
            let passageHTML = '';
            if (q.passage && q.passage.trim() !== "") {
                passageHTML = `<div class="p-6 bg-[#e9e9e9] rounded-lg border border-gray-300 text-[17px] sm:text-[19px] text-slate-800 font-mono whitespace-pre-wrap leading-relaxed shadow-sm">${q.passage}</div>`;
            }

            const imgTopHTML = q.imgTop 
                ? `<img src="${q.imgTop}" class="w-auto max-w-full h-auto mb-5 rounded border border-gray-200 object-contain" alt="자료 이미지">` 
                : '';
            const imgBottomHTML = q.imgBottom 
                ? `<img src="${q.imgBottom}" class="w-auto max-w-full h-auto mb-8 rounded border border-gray-200 object-contain" alt="자료 이미지">` 
                : '';
            
            const expImgHTML = q.explanationImg
                ? `<img src="${q.explanationImg}" class="w-auto max-w-full h-auto mb-4 rounded border border-gray-200 object-contain block" alt="해설 이미지">`
                : '';

            let upperContentHTML = '';
            if (q.refInstruction && q.refInstruction.trim() !== "") {
                const instructionHTML = `
                    <div class="mb-5 text-gray-900 leading-relaxed break-keep">
                        <span class="relative top-[6px] sm:top-[9px] text-[55px] sm:text-[70px] text-blue-600 mr-1 select-none leading-none align-baseline">※</span>
                        <span class="text-[22px] sm:text-[27px] font-medium align-baseline">${q.refInstruction}</span>
                    </div>
                `;
                upperContentHTML = `<div class="mb-8">${instructionHTML}${imgTopHTML}${passageHTML}</div>`;
            } else {
                if (passageHTML !== "" || imgTopHTML !== "") {
                    upperContentHTML = `<div class="mb-8">${imgTopHTML}${passageHTML}</div>`;
                }
            }

            wrapper.innerHTML = `
                ${upperContentHTML}
                <div class="question-header relative mb-5">
                    <h2 class="font-medium text-gray-900 leading-relaxed break-keep">
                        <span class="text-[32px] sm:text-[40px] font-bold text-blue-600 mr-2 select-none font-tnum leading-none align-baseline">${qNum}</span>
                        <span class="text-[22px] sm:text-[27px] align-baseline">${q.question}</span>
                    </h2>
                </div>
                ${imgBottomHTML}
                <div class="options-list flex flex-col space-y-2 ml-1 sm:ml-2 mb-8"></div>
                <div class="explanation-area mt-10 p-6 bg-gray-50 border border-gray-200 rounded-lg shadow-sm">
                    <div class="flex items-center gap-3 mb-4">
                        <span class="badge px-3 py-1.5 text-[15px] font-bold rounded bg-gray-200 text-gray-600 transition-colors">해설</span>
                        <h3 class="status-text font-bold text-[17px] text-gray-400 transition-colors">정답 확인 후 공개</h3>
                    </div>
                    <div class="exp-content blur-content">
                        ${expImgHTML}
                        <p class="text-gray-700 text-[17px] sm:text-[19px] leading-relaxed rounded">${q.explanation}</p>
                    </div>
                </div>
            `;

            const optionsContainer = wrapper.querySelector('.options-list');
            q.options.forEach((opt, optIdx) => {
                const btn = document.createElement('button');
                btn.className = "option-btn w-full text-left py-2 px-3 rounded transition-colors flex items-start group hover:bg-gray-100";
                btn.innerHTML = `
                    <div class="radio-outer mt-[3px] w-[22px] h-[22px] sm:w-[27px] sm:h-[27px] rounded-full border-[2.5px] border-blue-600 mr-4 flex-shrink-0 flex items-center justify-center transition-colors">
                        <div class="radio-inner w-[11px] h-[11px] sm:w-[13.5px] sm:h-[13.5px] bg-blue-600 rounded-full transform scale-0 transition-transform duration-200"></div>
                    </div>
                    <span class="text-[22px] sm:text-[27px] text-gray-800 leading-[1.2] break-keep pt-[0px]">${opt}</span>
                `;
                btn.onclick = () => handleAnswer(wrapper, q, optIdx, btn);
                optionsContainer.appendChild(btn);
            });

            container.appendChild(wrapper);
        });
    }

    // 4. 기존 정답 처리 함수 (변경 없음)
    function handleAnswer(wrapper, questionData, selectedIdx, clickedBtn) {
        // ... (기존 handleAnswer 로직 100% 동일) ...
        const isCorrect = selectedIdx === questionData.answer;
        const allBtns = wrapper.querySelectorAll('.option-btn');

        allBtns.forEach(btn => {
            btn.classList.remove('bg-[#e9e9e9]');
            const outer = btn.querySelector('.radio-outer');
            const inner = btn.querySelector('.radio-inner');
            
            outer.classList.remove('border-red-500'); 
            outer.classList.add('border-blue-600');
            inner.classList.remove('scale-100');
            inner.classList.add('scale-0');
        });

        wrapper.classList.remove('is-correct', 'is-wrong');

        clickedBtn.classList.add('bg-[#e9e9e9]');
        const activeOuter = clickedBtn.querySelector('.radio-outer');
        const activeInner = clickedBtn.querySelector('.radio-inner');
        
        activeOuter.classList.add('border-blue-600'); 
        activeInner.classList.remove('scale-0');
        activeInner.classList.add('scale-100');

        const expContent = wrapper.querySelector('.exp-content');
        const statusText = wrapper.querySelector('.status-text');
        const badge = wrapper.querySelector('.badge');

        if (isCorrect) {
            wrapper.classList.add('is-correct'); 
            expContent.classList.replace('blur-content', 'reveal-content');
            statusText.innerText = "정답입니다!";
            statusText.className = "status-text font-bold text-[17px] text-blue-600";
            badge.className = "badge px-3 py-1.5 text-[15px] font-bold rounded bg-blue-100 text-blue-600";
        } else {
            wrapper.classList.add('is-wrong');
            activeOuter.classList.remove('border-blue-600');
            activeOuter.classList.add('border-red-500');

            expContent.classList.replace('reveal-content', 'blur-content');
            statusText.innerText = "오답입니다.";
            statusText.className = "status-text font-bold text-[17px] text-red-500";
            badge.className = "badge px-3 py-1.5 text-[15px] font-bold rounded bg-red-100 text-red-500";
        }
    }
</script>
</body>
</html>
