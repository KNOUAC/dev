<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ë¬¸ì œ ë°ì´í„° JSON ì—ë””í„° (ë¶ˆëŸ¬ì˜¤ê¸° ì§€ì›)</title>
    <style>
        /* ê¸°ì¡´ ìŠ¤íƒ€ì¼ ìœ ì§€ ë° íŒŒì¼ ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì¶”ê°€ */
        body { font-family: 'Malgun Gothic', sans-serif; line-height: 1.6; padding: 20px; background: #f0f2f5; }
        .container { max-width: 900px; margin: auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); }
        h2 { border-bottom: 2px solid #007bff; padding-bottom: 10px; color: #333; }
        .section-title { font-weight: bold; color: #007bff; margin-top: 20px; margin-bottom: 10px; display: block; border-left: 4px solid #007bff; padding-left: 10px; }
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .full-width { grid-column: span 2; }
        label { display: block; font-weight: bold; margin-bottom: 5px; font-size: 0.9em; }
        input, textarea, select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; }
        textarea { height: 120px; font-family: 'Consolas', monospace; font-size: 0.9em; }
        .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; background: #f9f9f9; padding: 15px; border-radius: 6px; }
        .btn-group { margin-top: 30px; display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; }
        button { padding: 12px 20px; cursor: pointer; border: none; border-radius: 6px; font-weight: bold; transition: 0.2s; }
        .btn-save { background: #28a745; color: white; }
        .btn-json { background: #007bff; color: white; }
        .btn-load { background: #6f42c1; color: white; } /* ë¶ˆëŸ¬ì˜¤ê¸° ë²„íŠ¼ ìƒ‰ìƒ */
        .btn-clear { background: #6c757d; color: white; }
        #json-output { margin-top: 25px; background: #2d2d2d; color: #ccc; padding: 20px; border-radius: 8px; white-space: pre-wrap; font-family: 'Consolas', monospace; font-size: 0.85em; max-height: 400px; overflow-y: auto; }
        #file-input { display: none; } /* ì‹¤ì œ íŒŒì¼ ì¸í’‹ì€ ìˆ¨ê¹€ */
        .item-count { font-size: 1.1em; margin-bottom: 15px; text-align: right; }
    </style>
</head>
<body>

<div class="container">
    <h2>ğŸ§© ë¬¸ì œ ë°ì´í„° JSON ì—ë””í„° v2</h2>
    <div class="item-count">í˜„ì¬ ì €ì¥ëœ ë¬¸í•­: <b id="count">0</b>ê°œ</div>

    <div class="form-grid">
        <div class="form-group">
            <label>ë¬¸í•­ ë²ˆí˜¸ (ID)</label>
            <input type="number" id="inp-id">
        </div>
        <div class="form-group">
            <label>ì°¸ì¡° ì•ˆë‚´ë¬¸ (refInstruction)</label>
            <input type="text" id="inp-ref">
        </div>
        <div class="form-group"><label>ìƒë‹¨ ì´ë¯¸ì§€ (imgTop)</label><input type="text" id="inp-imgTop"></div>
        <div class="form-group"><label>í•˜ë‹¨ ì´ë¯¸ì§€ (imgBottom)</label><input type="text" id="inp-imgBottom"></div>
        <div class="form-group full-width"><label>ì§ˆë¬¸ (Question)</label><input type="text" id="inp-q"></div>
        <div class="form-group full-width"><label>ì§€ë¬¸ (Passage)</label><textarea id="inp-p"></textarea></div>

        <div class="full-width">
            <span class="section-title">ë³´ê¸° ë° ì •ë‹µ ì„¤ì •</span>
            <div class="options-grid">
                <input type="text" class="opt" placeholder="ë³´ê¸° 1">
                <input type="text" class="opt" placeholder="ë³´ê¸° 2">
                <input type="text" class="opt" placeholder="ë³´ê¸° 3">
                <input type="text" class="opt" placeholder="ë³´ê¸° 4">
                <select id="inp-ans">
                    <option value="0">ë³´ê¸° 1ë²ˆ ì •ë‹µ</option>
                    <option value="1">ë³´ê¸° 2ë²ˆ ì •ë‹µ</option>
                    <option value="2">ë³´ê¸° 3ë²ˆ ì •ë‹µ</option>
                    <option value="3">ë³´ê¸° 4ë²ˆ ì •ë‹µ</option>
                </select>
            </div>
        </div>

        <div class="form-group full-width">
            <span class="section-title">í•´ì„¤ ì„¤ì •</span>
            <label>í•´ì„¤ ì´ë¯¸ì§€ (explanationImg)</label><input type="text" id="inp-expImg">
            <label>í•´ì„¤ í…ìŠ¤íŠ¸ (explanation)</label><textarea id="inp-exp" style="height: 60px;"></textarea>
        </div>
    </div>

    <div class="btn-group">
        <button class="btn-load" onclick="document.getElementById('file-input').click()">JSON íŒŒì¼ ë¶ˆëŸ¬ì˜¤ê¸°</button>
        <input type="file" id="file-input" accept=".json" onchange="loadJSONFile(event)">
        
        <button class="btn-save" onclick="addItem()">ë¬¸í•­ ì¶”ê°€</button>
        <button class="btn-json" onclick="exportJSON()">JSON ì½”ë“œ ë³µì‚¬</button>
        <button class="btn-clear" onclick="resetForm()">ì…ë ¥ì°½ ì´ˆê¸°í™”</button>
    </div>

    <div id="json-output">// ì €ì¥ëœ ë¬¸í•­ì´ ì—†ìŠµë‹ˆë‹¤.</div>
</div>

<script>
    let db = [];

    // JSON íŒŒì¼ì„ ì½ì–´ì„œ db ë°°ì—´ì— í• ë‹¹í•˜ëŠ” í•¨ìˆ˜
    function loadJSONFile(event) {
        const file = event.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const importedData = JSON.parse(e.target.result);
                if (Array.isArray(importedData)) {
                    db = importedData;
                    updateDisplay();
                    alert(db.length + "ê°œì˜ ë¬¸í•­ì„ ì„±ê³µì ìœ¼ë¡œ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.");
                } else {
                    alert("ì˜¬ë°”ë¥¸ JSON ë°°ì—´ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.");
                }
            } catch (err) {
                alert("íŒŒì¼ ì½ê¸° ì˜¤ë¥˜: " + err.message);
            }
        };
        reader.readAsText(file);
    }

    function addItem() {
        const idVal = document.getElementById('inp-id').value;
        const qVal = document.getElementById('inp-q').value;
        if(!idVal || !qVal) { alert("IDì™€ ì§ˆë¬¸ì€ í•„ìˆ˜ì…ë‹ˆë‹¤."); return; }

        const item = {
            id: parseInt(idVal),
            refInstruction: document.getElementById('inp-ref').value || undefined,
            imgTop: document.getElementById('inp-imgTop').value || undefined,
            imgBottom: document.getElementById('inp-imgBottom').value || undefined,
            passage: document.getElementById('inp-p').value || "",
            question: qVal,
            options: Array.from(document.querySelectorAll('.opt')).map(i => i.value),
            answer: parseInt(document.getElementById('inp-ans').value),
            explanationImg: document.getElementById('inp-expImg').value || undefined,
            explanation: document.getElementById('inp-exp').value || ""
        };

        // ë°ì´í„° ì •ì œ ë° ì¶”ê°€
        Object.keys(item).forEach(key => (item[key] === undefined || item[key] === "") && delete item[key]);
        
        // ê¸°ì¡´ì— ê°™ì€ IDê°€ ìˆë‹¤ë©´ ìˆ˜ì •, ì—†ìœ¼ë©´ ì¶”ê°€
        const existingIdx = db.findIndex(x => x.id === item.id);
        if(existingIdx > -1) {
            if(confirm(item.id + "ë²ˆ ë¬¸í•­ì´ ì´ë¯¸ ì¡´ì¬í•©ë‹ˆë‹¤. ë®ì–´ì“°ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                db[existingIdx] = item;
            }
        } else {
            db.push(item);
        }

        updateDisplay();
        document.getElementById('inp-id').value = parseInt(idVal) + 1;
    }

    function updateDisplay() {
        document.getElementById('count').innerText = db.length;
        document.getElementById('json-output').innerText = JSON.stringify(db, null, 4);
    }

    function exportJSON() {
        const text = JSON.stringify(db, null, 4);
        navigator.clipboard.writeText(text).then(() => alert("JSON ë³µì‚¬ ì™„ë£Œ!"));
    }

    function resetForm() {
        ['inp-ref', 'inp-imgTop', 'inp-imgBottom', 'inp-p', 'inp-q', 'inp-expImg', 'inp-exp'].forEach(id => document.getElementById(id).value = '');
        document.querySelectorAll('.opt').forEach(opt => opt.value = '');
    }
</script>

</body>
</html>
